# Shared SSH defaults (managed via YADM)
Host *
    # Connection multiplexing -- reuse existing connections
    # Second SSH to same host is near-instant (no new TCP/auth handshake)
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h-%p
    ControlPersist 600

    # Keepalive -- send every 30s, tolerate 3 missed = 90s detection
    ServerAliveInterval 30
    ServerAliveCountMax 3

    # SSH agent -- use local keys on remote machines
    # Note: ForwardAgent has security implications on untrusted servers
    AddKeysToAgent yes
    ForwardAgent yes

    # Compression -- helps on slow links, negligible on fast ones
    Compression yes

    # TERM handling -- remote machines lack xterm-ghostty terminfo
    SetEnv TERM=xterm-256color

    # Connection reliability
    TCPKeepAlive yes
    ConnectionAttempts 3

    # Security
    IdentitiesOnly yes
    HashKnownHosts no
    StrictHostKeyChecking ask
